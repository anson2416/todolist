import "dart:html";import "dart:convert";import "dart:async";WebSocket j;void main(){l();querySelector("#submit").onClick.listen((MouseEvent h){print("Send mesaage");var g=querySelector("#editor");g.querySelectorAll("br").forEach((Element h){h.text="<{#}>";});var k=JSON.encode({'Type':'new','Data':{'channel':'piazza','author':'unknown','content':g.text}});print(g.text);j.send(k);g.text="";});querySelectorAll(".toolbar .btn.btn-success").forEach((Element i){i.onClick.listen((MouseEvent h){print(i.parent.parent.id);});});}void l([int i=2]){var m=false;print("Connecting to websocket");j=new WebSocket('ws://127.0.0.1:4000/ws');void n(){if(!m){new Timer(new Duration(milliseconds:1000*i),()=>l(i*2));}m=true;}j.onOpen.listen((g){print('Connected');i=2;});j.onClose.listen((g){print('Websocket closed, retrying in ${i} seconds');n();});j.onError.listen((g){print("Error connecting to ws");n();});j.onMessage.listen((MessageEvent g){var h=JSON.decode(g.data.toString());switch (h["Type"]){case "newMsg":var k=new Element.html('<div id="${h["Data"]["ID"]}" class="content"><p>${h["Data"]["Content"]}</p><div class="editor editor-reply"></div><div class="toolbar"><a class="btn btn-success">回复</a></div></div>');k.querySelector(".editor.editor-reply").attributes['contenteditable']='true';k.querySelector(".toolbar .btn.btn-success").onClick.listen((MouseEvent g){print(h["Data"]["ID"]);});querySelector("#stream").insertBefore(k,querySelector("#stream .content"));break;case "error":print(h["Data"]);break;}});}const AB='mangledGlobalNames';class o{static const String BB="Chrome";static const String CB="Firefox";static const String DB="Internet Explorer";static const String EB="Opera";static const String FB="Safari";final String v;final String minimumVersion;const o(this.v,[this.minimumVersion]);}class q{const q();}class s{final String name;const s(this.name);}class t{const t();}class u{const u();}